function loadWidget(e) {
    let t, {
            waifuPath: o,
            apiPath: n,
            cdnPath: a
        } = e,
        i = !1;
    if ("string" == typeof a) i = !0, a.endsWith("/") || (a += "/");
    else {
        if ("string" != typeof n) return void console.error("Invalid initWidget argument!");
        n.endsWith("/") || (n += "/")
    }

    function s(e) {
        return Array.isArray(e) ? e[Math.floor(Math.random() * e.length)] : e
    }
    localStorage.removeItem("waifu-display"), sessionStorage.removeItem("waifu-text"), document.body.insertAdjacentHTML("beforeend", '<div id="waifu">\n\t\t\t<div id="waifu-tips"></div>\n\t\t\t<canvas id="live2d" width="800" height="800"></canvas>\n\t\t\t<div id="waifu-tool">\n\t\t\t\t<span class="fa fa-lg fa-comment"></span>\n\t\t\t\t<span class="fa fa-lg fa-paper-plane"></span>\n\t\t\t\t<span class="fa fa-lg fa-user-circle"></span>\n\t\t\t\t<span class="fa fa-lg fa-street-view"></span>\n\t\t\t\t<span class="fa fa-lg fa-camera-retro"></span>\n\t\t\t\t<span class="fa fa-lg fa-info-circle"></span>\n\t\t\t\t<span class="fa fa-lg fa-times"></span>\n\t\t\t</div>\n\t\t</div>'), setTimeout(() => {
        document.getElementById("waifu").style.bottom = "0"
    }, 0);
    let l, d, r = !1,
        c = ["Đã lâu rồi không gặp bạn, thời gian trôi quá thật chóng vánh...", "Bạn đã từng không quan tâm đến một người khác trong bao lâu vậy?", "Bạn ơi chơi với mình đi!", "Học đi bạn! Đừng vào đây ngắm mình!", "Học không chơi đánh rơi tuổi trẻ \n Chơi không học gái trẻ lại bỏ rơi!"];

    function m() {
        fetch("https://api.quotable.io/random").then(e => e.json()).then(e => {
            u(e.content, 6e3, 9)
        })
    }

    function u(e, t, o) {
        if (!e || sessionStorage.getItem("waifu-text") && sessionStorage.getItem("waifu-text") > o) return;
        d && (clearTimeout(d), d = null), e = s(e), sessionStorage.setItem("waifu-text", o);
        const n = document.getElementById("waifu-tips");
        n.innerHTML = e, n.classList.add("waifu-tips-active"), d = setTimeout(() => {
            sessionStorage.removeItem("waifu-text"), n.classList.remove("waifu-tips-active")
        }, t)
    }
    async function f() {
        const e = await fetch(`${a}model_list.json`);
        t = await e.json()
    }
    async function g(e, o, l) {
        if (localStorage.setItem("modelId", e), localStorage.setItem("modelTexturesId", o), u(l, 4e3, 10), i) {
            t || await f();
            const o = s(t.models[e]);
            loadlive2d("live2d", `${a}model/${o}/index.json`)
        } else loadlive2d("live2d", `${n}get/?id=${e}-${o}`)
    }
    async function p() {
        const e = localStorage.getItem("modelId"),
            o = localStorage.getItem("modelTexturesId");
        if (i) {
            t || await f();
            const o = s(t.models[e]);
            loadlive2d("live2d", `${a}model/${o}/index.json`), u("Thấy mình đẹp không bạn hiền??", 4e3, 10)
        } else fetch(`${n}rand_textures/?id=${e}-${o}`).then(e => e.json()).then(t => {
            1 !== t.textures.id || "1" !== o && "0" !== o ? g(e, t.textures.id, "Thấy mình đẹp không bạn hiền??") : u("I don’t have any other clothes yet!", 4e3, 10)
        })
    }
    async function w() {
        let e = localStorage.getItem("modelId");
        if (i) {
            t || await f();
            const o = ++e >= t.models.length ? 0 : e;
            await g(o, 0, t.models[o])
        } else fetch(`${n}switch/?id=${e}`).then(e => e.json()).then(e => {
            g(e.model.id, 0, e.model.message)
        })
    }
    window.addEventListener("mousemove", () => r = !0), window.addEventListener("keydown", () => r = !0), setInterval(() => {
            r ? (r = !1, clearInterval(l), l = null) : l || (l = setInterval(() => {
                u(s(c), 6e3, 9)
            }, 2e4))
        }, 1e3),
        function() {
            document.querySelector("#waifu-tool .fa-comment").addEventListener("click", m), document.querySelector("#waifu-tool .fa-paper-plane").addEventListener("click", () => {
                if (window.Asteroids) window.ASTEROIDSPLAYERS || (window.ASTEROIDSPLAYERS = []), window.ASTEROIDSPLAYERS.push(new Asteroids);
                else {
                    const e = document.createElement("script");
                    e.src = "https://cdn.jsdelivr.net/gh/stevenjoezhang/asteroids/asteroids.js", document.head.appendChild(e)
                }
            }), document.querySelector("#waifu-tool .fa-user-circle").addEventListener("click", w), document.querySelector("#waifu-tool .fa-street-view").addEventListener("click", p), document.querySelector("#waifu-tool .fa-camera-retro").addEventListener("click", () => {
                u("Ảnh mình đấy, cute không?", 6e3, 9), Live2D.captureName = "photo" + Date.now().toString() + ".png", Live2D.captureFrame = !0
            }), document.querySelector("#waifu-tool .fa-info-circle").addEventListener("click", () => {
                open("https://github.com/Windrist/"), open("https://www.linkedin.com/in/dong-tran-huu-quoc-b21149212/")
            }), document.querySelector("#waifu-tool .fa-times").addEventListener("click", () => {
                u("Bạn sẽ người người quan trọng của đời mình vào một ngày không xa.", 2e3, 11), document.getElementById("waifu").style.bottom = "-500px", setTimeout(() => {
                    document.getElementById("waifu").style.display = "none", document.getElementById("waifu-toggle").classList.add("waifu-toggle-active")
                }, 3e3)
            });
            window.addEventListener("copy", () => {
                u("Copy gì đấy bạn ơi? Copy nhớ để lại nguồn!", 6e3, 9)
            }), window.addEventListener("visibilitychange", () => {
                document.hidden || u("Wow, bạn quay lại rồi đấy à?", 6e3, 9)
            })
        }(),
        function() {
            let e;
            if ("/" === location.pathname) {
                const t = (new Date).getHours();
                e = t > 5 && t <= 7 ? "Chào buổi sáng! Vận động đi bạn, rồi ngày hôm nay sẽ là một ngày tươi đẹp. " : t > 7 && t <= 11 ? "Chào buổi sáng! Chăm chỉ đấy nhưng đừng ngồi quá lâu, thoát vị đĩa đệm không chừa một ai đâu bạn hiền! " : t > 11 && t <= 13 ? "Trưa rồi bạn, cả sáng làm việc rồi chứ? Đi ăn cơm rồi nghỉ trưa thôi! " : t > 13 && t <= 17 ? "Buổi chiều dễ buồn ngủ lắm đấy. Nhớ tập thể dục đi nha! " : t > 17 && t <= 19 ? "Trời tối rồi! Ngày hôm nay của bạn thế nào? " : t > 19 && t <= 21 ? "Tối nay bạn định làm gì thế? " : t > 21 && t <= 23 ? ["Đêm buông xuống rồi, nghỉ ngơi thôi bạn! ", "Nhớ ngủ sớm không có hại cho sức khỏe! "] : "Bạn là cú đêm à? Bạn định ngày mai ngủ dậy như thế nào đấy? "
            } else if ("" !== document.referrer) {
                const t = new URL(document.referrer),
                    o = t.hostname.split(".")[1];
                e = location.hostname === t.hostname ? `Chào mừng bạn đến với <br><span>「${document.title.split(" - ")[0]}」</span>` : "google" === o ? `Chào bạn hiền đến từ Google Search<br>Chào mừng bạn đến với <span>" ${document.title.split("-")[0]}”</span>` : `Xin chào！Bạn của <span>${t.hostname}</span> đây!`
            } else e = `Chào mừng bạn đến với <span>「${document.title.split(" - ")[0]}」</span>`;
            u(e, 7e3, 8)
        }(),
        function() {
            let e = localStorage.getItem("modelId"),
                t = localStorage.getItem("modelTexturesId");
            null === e && (e = 1, t = 53), g(e, t).then(e => {}), fetch(o).then(e => e.json()).then(e => {
                window.addEventListener("mouseover", t => {
                    for (let {
                            selector: o,
                            text: n
                        }
                        of e.mouseover)
                        if (t.target.matches(o)) return void u(n = (n = s(n)).replace("{text}", t.target.innerText), 4e3, 8)
                }), window.addEventListener("click", t => {
                    for (let {
                            selector: o,
                            text: n
                        }
                        of e.click)
                        if (t.target.matches(o)) return void u(n = (n = s(n)).replace("{text}", t.target.innerText), 4e3, 8)
                }), e.seasons.forEach(({
                    date: e,
                    text: t
                }) => {
                    const o = new Date,
                        n = e.split("-")[0],
                        a = e.split("-")[1] || n;
                    n.split("/")[0] <= o.getMonth() + 1 && o.getMonth() + 1 <= a.split("/")[0] && n.split("/")[1] <= o.getDate() && o.getDate() <= a.split("/")[1] && (t = (t = s(t)).replace("{year}", o.getFullYear()), c.push(t))
                })
            })
        }()
}

function initWidget(e, t) {
    "string" == typeof e && (e = {
        waifuPath: e,
        apiPath: t
    }), document.body.insertAdjacentHTML("beforeend", '<div id="waifu-toggle">\n\t\t\t<span>Kanban girl</span>\n\t\t</div>');
    const o = document.getElementById("waifu-toggle");
    o.addEventListener("click", () => {
        o.classList.remove("waifu-toggle-active"), o.getAttribute("first-time") ? (loadWidget(e), o.removeAttribute("first-time")) : (localStorage.removeItem("waifu-display"), document.getElementById("waifu").style.display = "", setTimeout(() => {
            document.getElementById("waifu").style.bottom = "0"
        }, 0))
    }), loadWidget(e)
}